<!DOCTYPE html>
<html><head>
<meta charset="utf-8">
<title>nerd-art</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #1a1b26;
    color: #c0caf5;
    font-family: system-ui, sans-serif;
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
  }
  #controls {
    display: flex;
    gap: 16px;
    align-items: center;
    padding: 8px 12px;
    background: #24283b;
    border-bottom: 1px solid #414868;
    flex-shrink: 0;
    flex-wrap: wrap;
  }
  .control {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
  }
  .control label { color: #7aa2f7; white-space: nowrap; }
  .control input[type="range"] { width: 120px; }
  .control .value {
    color: #bb9af7;
    font-family: monospace;
    min-width: 40px;
    text-align: right;
  }
  .control input[type="checkbox"] { accent-color: #7aa2f7; }
  button, .file-label {
    background: #414868;
    color: #c0caf5;
    border: 1px solid #565f89;
    padding: 4px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
  }
  button:hover, .file-label:hover { background: #565f89; }
  #fileInput { display: none; }
  #status {
    color: #565f89;
    font-size: 12px;
    margin-left: auto;
  }
  select {
    background: #414868;
    color: #c0caf5;
    border: 1px solid #565f89;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 13px;
  }
  #groups {
    display: flex;
    gap: 12px;
    padding: 6px 12px;
    background: #1f2335;
    border-bottom: 1px solid #414868;
    flex-shrink: 0;
    flex-wrap: wrap;
    font-size: 12px;
  }
  .group-toggle {
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .group-toggle input { accent-color: #7aa2f7; }
  .group-toggle label { cursor: pointer; }
  .group-toggle .ambiguous { color: #e0af68; font-size: 10px; }
  #artContainer {
    flex: 1;
    overflow: auto;
    padding: 8px;
  }
  #art {
    font-family: "SauceCodePro Nerd Font Mono", monospace;
    font-size: 14px;
    line-height: 1.0;
  }
  .art-line { white-space: nowrap; }
  .art-line span {
    display: inline-block;
    width: 1ch;
    overflow: hidden;
    text-align: center;
  }
  #art.pre-mode {
    white-space: pre;
    line-height: 1.0;
  }
  #dropOverlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(122, 162, 247, 0.15);
    border: 3px dashed #7aa2f7;
    z-index: 100;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: #7aa2f7;
  }
  #dropOverlay.active { display: flex; }
</style>
</head>
<body>

<div id="dropOverlay">Drop image here</div>

<div id="controls">
  <label class="file-label" for="fileInput">Open image…</label>
  <input type="file" id="fileInput" accept="image/*">
  <div class="control">
    <label>Width:</label>
    <input type="range" id="widthSlider" min="20" max="200" value="60">
    <span class="value" id="widthVal">60</span>
  </div>
  <div class="control">
    <label>Contrast:</label>
    <input type="range" id="contrastSlider" min="-100" max="100" value="0" step="1">
    <span class="value" id="contrastVal">0.00</span>
  </div>
  <div class="control">
    <label>Lightness:</label>
    <input type="range" id="lightnessSlider" min="-100" max="100" value="0" step="1">
    <span class="value" id="lightnessVal">0.00</span>
  </div>
  <div class="control">
    <label>Dither:</label>
    <input type="checkbox" id="ditherCheck">
  </div>
  <div class="control">
    <label>Preview:</label>
    <select id="previewMode">
      <option value="span">Fixed grid</option>
      <option value="pre">Raw pre</option>
    </select>
  </div>
  <button id="copyBtn">Copy text</button>
  <button id="saveBtn">Save text…</button>
  <span id="status"></span>
</div>
<div id="groups"></div>

<div id="artContainer">
  <div id="art">Drop an image or click "Open image…" to start.</div>
</div>

<canvas id="glyphCanvas" style="display:none"></canvas>
<canvas id="imgCanvas" style="display:none"></canvas>

<script>
  // File picker
  document.getElementById("fileInput").addEventListener("change", (e) => {
    if (e.target.files[0]) window.loadImageFromFile(e.target.files[0]);
  });

  // Drag and drop
  const overlay = document.getElementById("dropOverlay");
  let dragCounter = 0;
  document.addEventListener("dragenter", (e) => {
    e.preventDefault();
    dragCounter++;
    overlay.classList.add("active");
  });
  document.addEventListener("dragleave", (e) => {
    e.preventDefault();
    dragCounter--;
    if (dragCounter <= 0) { overlay.classList.remove("active"); dragCounter = 0; }
  });
  document.addEventListener("dragover", (e) => e.preventDefault());
  document.addEventListener("drop", (e) => {
    e.preventDefault();
    dragCounter = 0;
    overlay.classList.remove("active");
    const file = e.dataTransfer.files[0];
    if (file && file.type.startsWith("image/")) window.loadImageFromFile(file);
  });
</script>
<script src="interactive-renderer.js"></script>
</body></html>
